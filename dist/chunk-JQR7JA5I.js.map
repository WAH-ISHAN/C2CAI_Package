{"version":3,"sources":["../src/client/widget.ts"],"sourcesContent":["export function C2CAIWidget(opts: { endpoint: string }) {\r\n  const state = { open: false, sessionId: crypto.randomUUID() };\r\n  const btn = document.createElement(\"button\");\r\n  btn.textContent = \"ðŸ’¬ Chat\";\r\n  Object.assign(btn.style, { position:\"fixed\", bottom:\"20px\", right:\"20px\", zIndex:\"9999\", padding:\"10px 14px\", borderRadius:\"999px\", background:\"#111\", color:\"#fff\" });\r\n  document.body.appendChild(btn);\r\n\r\n  const panel = document.createElement(\"div\");\r\n  panel.innerHTML = `<div style=\"width:320px;height:420px;background:#fff;position:fixed;bottom:70px;right:20px;border:1px solid #ddd;border-radius:12px;display:none;flex-direction:column;overflow:hidden;font-family:system-ui\">\r\n    <div style=\"padding:10px;border-bottom:1px solid #eee;font-weight:600\">C2CAI Assistant</div>\r\n    <div id=\"c2cai-log\" style=\"flex:1;padding:10px;overflow:auto;font-size:14px\"></div>\r\n    <div style=\"display:flex;border-top:1px solid #eee\">\r\n      <input id=\"c2cai-in\" style=\"flex:1;padding:10px;border:0;outline:none\" placeholder=\"Ask me anything...\" />\r\n      <button id=\"c2cai-send\" style=\"padding:10px 12px;border:0;background:#111;color:#fff\">Send</button>\r\n    </div>\r\n  </div>`;\r\n  Object.assign(panel.style, { zIndex: \"9999\" });\r\n  document.body.appendChild(panel);\r\n\r\n  const box = panel.firstElementChild as HTMLDivElement;\r\n  const log = panel.querySelector(\"#c2cai-log\") as HTMLDivElement;\r\n  const input = panel.querySelector(\"#c2cai-in\") as HTMLInputElement;\r\n  const send = panel.querySelector(\"#c2cai-send\") as HTMLButtonElement;\r\n\r\n  function pageContext() {\r\n    const main = document.querySelector(\"main\") || document.body;\r\n    const txt = (main?.textContent || \"\").replace(/\\s+/g, \" \").trim().slice(0, 4000);\r\n    return { url: location.href, title: document.title, text: txt };\r\n    }\r\n\r\n  function add(role:string, text:string) {\r\n    const div = document.createElement(\"div\");\r\n    div.style.margin = \"6px 0\";\r\n    div.innerHTML = `<div style=\"font-weight:600\">${role}</div><div>${text}</div>`;\r\n    log.appendChild(div);\r\n    log.scrollTop = log.scrollHeight;\r\n  }\r\n\r\n  btn.onclick = () => { state.open = !state.open; box!.style.display = state.open ? \"flex\" : \"none\"; };\r\n  send.onclick = async () => {\r\n    const msg = input.value.trim();\r\n    if (!msg) return;\r\n    add(\"You\", msg);\r\n    input.value = \"\";\r\n    const res = await fetch(opts.endpoint + \"/chat\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ message: msg, page: pageContext(), sessionId: state.sessionId })\r\n    }).then(r => r.json());\r\n    add(\"C2CAI\", `${res.answer}\\n\\nSources:\\n${(res.sources||[]).join(\"\\n\")}`);\r\n  };\r\n\r\n  // auto-refresh context on route changes\r\n  [\"popstate\",\"hashchange\"].forEach(ev => window.addEventListener(ev, () => {}));\r\n}"],"mappings":";AAAO,SAAS,YAAY,MAA4B;AACtD,QAAM,QAAQ,EAAE,MAAM,OAAO,WAAW,OAAO,WAAW,EAAE;AAC5D,QAAM,MAAM,SAAS,cAAc,QAAQ;AAC3C,MAAI,cAAc;AAClB,SAAO,OAAO,IAAI,OAAO,EAAE,UAAS,SAAS,QAAO,QAAQ,OAAM,QAAQ,QAAO,QAAQ,SAAQ,aAAa,cAAa,SAAS,YAAW,QAAQ,OAAM,OAAO,CAAC;AACrK,WAAS,KAAK,YAAY,GAAG;AAE7B,QAAM,QAAQ,SAAS,cAAc,KAAK;AAC1C,QAAM,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQlB,SAAO,OAAO,MAAM,OAAO,EAAE,QAAQ,OAAO,CAAC;AAC7C,WAAS,KAAK,YAAY,KAAK;AAE/B,QAAM,MAAM,MAAM;AAClB,QAAM,MAAM,MAAM,cAAc,YAAY;AAC5C,QAAM,QAAQ,MAAM,cAAc,WAAW;AAC7C,QAAM,OAAO,MAAM,cAAc,aAAa;AAE9C,WAAS,cAAc;AACrB,UAAM,OAAO,SAAS,cAAc,MAAM,KAAK,SAAS;AACxD,UAAM,OAAO,MAAM,eAAe,IAAI,QAAQ,QAAQ,GAAG,EAAE,KAAK,EAAE,MAAM,GAAG,GAAI;AAC/E,WAAO,EAAE,KAAK,SAAS,MAAM,OAAO,SAAS,OAAO,MAAM,IAAI;AAAA,EAC9D;AAEF,WAAS,IAAI,MAAa,MAAa;AACrC,UAAM,MAAM,SAAS,cAAc,KAAK;AACxC,QAAI,MAAM,SAAS;AACnB,QAAI,YAAY,gCAAgC,IAAI,cAAc,IAAI;AACtE,QAAI,YAAY,GAAG;AACnB,QAAI,YAAY,IAAI;AAAA,EACtB;AAEA,MAAI,UAAU,MAAM;AAAE,UAAM,OAAO,CAAC,MAAM;AAAM,QAAK,MAAM,UAAU,MAAM,OAAO,SAAS;AAAA,EAAQ;AACnG,OAAK,UAAU,YAAY;AACzB,UAAM,MAAM,MAAM,MAAM,KAAK;AAC7B,QAAI,CAAC,IAAK;AACV,QAAI,OAAO,GAAG;AACd,UAAM,QAAQ;AACd,UAAM,MAAM,MAAM,MAAM,KAAK,WAAW,SAAS;AAAA,MAC/C,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,MAC9C,MAAM,KAAK,UAAU,EAAE,SAAS,KAAK,MAAM,YAAY,GAAG,WAAW,MAAM,UAAU,CAAC;AAAA,IACxF,CAAC,EAAE,KAAK,OAAK,EAAE,KAAK,CAAC;AACrB,QAAI,SAAS,GAAG,IAAI,MAAM;AAAA;AAAA;AAAA,GAAkB,IAAI,WAAS,CAAC,GAAG,KAAK,IAAI,CAAC,EAAE;AAAA,EAC3E;AAGA,GAAC,YAAW,YAAY,EAAE,QAAQ,QAAM,OAAO,iBAAiB,IAAI,MAAM;AAAA,EAAC,CAAC,CAAC;AAC/E;","names":[]}